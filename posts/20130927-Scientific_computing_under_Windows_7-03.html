<!DOCTYPE html>
<html>
<head>
<title>Scientific computing under Windows 7, part 3: MPI</title>
<!-- 2014-12-19 Fri 06:24 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="SÃ©bastien Brisard">
<link href="./../css/theme.css" rel="stylesheet" />
<script type="text/javascript">window.twttr = (function (d, s, id) {var t, js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src= "https://platform.twitter.com/widgets.js"; fjs.parentNode.insertBefore(js, fjs); return window.twttr || (t = { _e: [], ready: function (f) { t._e.push(f) } }); }(document, "script", "twitter-wjs"));</script>
</head>
<body>
<div id="preamble" class="status">
<div class="navbar"><a href="./../index.html">Home</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="./../pages/about.html">About me</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="./../pages/references.html">References</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="./../posts/archives.html">Archives</a></div
</div>
<div id="content">
<h1 class="title">Scientific computing under Windows 7, part 3: MPI</h1>
<p>
From the <a href="http://www.mpich.org/">official website</a>
</p>

<blockquote>
<p>
The goals of MPICH are:
</p>
<ol class="org-ol">
<li>to provide an MPI implementation that efficiently supports different computation and communication platforms including commodity clusters (desktop systems, shared-memory systems, multicore architectures), high-speed networks and proprietary high-end computing systems (Blue Gene, Cray)
</li>
<li>to enable cutting-edge research in MPI through an easy-to-extend modular framework for other derived implementations
</li>
</ol>
</blockquote>

<p>
I didn't manage to compile MPICH with MinGW and had to resort to precompiled binaries, which can be downloaded from the <a href="http://www.microsoft.com/en-us/download/details.aspx?id=36045">Microsoft website</a> (HPC Pack 2012 MS-MPI Redistributable Package). Install this pack to e.g. <code>C:\opt\Microsoft_HPC_Pack_2012</code>. To check that MPI indeed works, edit the following <code>hello.c</code> file
</p>

<div class="org-src-container">

<pre class="src src-c"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;mpi.h&gt;</span>

<span class="org-type">int</span> <span class="org-function-name">main</span>(<span class="org-type">int</span> <span class="org-variable-name">argc</span>, <span class="org-type">char</span> **<span class="org-variable-name">argv</span>) {
  <span class="org-type">int</span> <span class="org-variable-name">rank</span>, <span class="org-variable-name">size</span>;

  MPI_Init (&amp;argc, &amp;argv);
  MPI_Comm_rank (MPI_COMM_WORLD, &amp;rank);
  MPI_Comm_size (MPI_COMM_WORLD, &amp;size);
  printf( <span class="org-string">"Hello world from process %d of %d\n"</span>, rank, size);
  MPI_Finalize();
  <span class="org-keyword">return</span> 0;
}
</pre>
</div>

<p>
When using this precompiled library with MinGW, you might run into the following error
</p>

<pre class="example">
c:/opt/Microsoft_HPC_Pack_2012/Inc/mpi.h:137:1: error: unknown type name '__int64' typedef __int64 MPI_Offset;
</pre>

<p>
<code>__int64__</code> is defined in the header file <code>_mingw.h</code>, so I just added the following line
</p>

<div class="org-src-container">

<pre class="src src-c"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;_mingw.h&gt;</span>
</pre>
</div>

<p>
at the top of file <code>C:\opt\Microsoft_HPC_Pack_2012\Inc\mpi.h</code>.
</p>

<p>
This pack does not ship with a version of <code>mpicc</code>. Therefore, to compile, you need to specify the full path to the MPI headers and libraries
</p>

<pre class="example">
$ mingw32-gcc -o hello.exe hello.c -I/C/opt/Microsoft_HPC_Pack_2012/Inc -L/C/opt/Microsoft_HPC_Pack_2012/Lib/i386 -lmsmpi
</pre>

<p>
Note that the program is linked against the 32 bit library, as the standard MinGW is a 32 bit system. Then run the example::
</p>

<pre class="example">
$ /C/opt/Microsoft_HPC_Pack_2012/Bin/mpiexec.exe -np 4 hello.exe
Hello world from process 3 of 4
Hello world from process 1 of 4
Hello world from process 2 of 4
Hello world from process 0 of 4
</pre>

<p>
It works!
</p>
</div>
<div id="postamble" class="status">
<a class="twitter-follow-button" href="https://twitter.com/SebBrisard" data-show-count="true" data-lang="en">Follow @SebBrisard</a>
</div>
</body>
</html>
